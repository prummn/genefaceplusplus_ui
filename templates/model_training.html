<!-- templates/model_training.html -->
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>цибхЮЛшонч╗ГчХМщЭв</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/instruction.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/model_training.css') }}">
</head>

<body class="subpage-bg">

    <button onclick="window.location.href='/'" class="back-btn">тЖР ш┐ФхЫЮ</button>
    <button class="vg-help-button" id="vg_openHelpBtn">хПВцХ░шп┤цШО</button>

    <div class="page-container">
        <h2>цибхЮЛшонч╗ГчХМщЭв</h2>
        <div class="video-page-container">
            <!-- х╖жф╛з -->
            <div class="video-display">
                <video id="trainVideo" controls>
                    <source id="videoSource" src="" type="video/mp4">
                </video>

                <!-- ф╗╗хКбчК╢цАБ - ц╖▒шЙ▓ф╕╗щвШ -->
                <div id="taskStatus" class="task-status">
                    <div class="status-row">
                        <span class="label">ф╗╗хКб ID:</span>
                        <span class="value" id="taskId">-</span>
                    </div>
                    <div class="status-row">
                        <span class="label">чК╢цАБ:</span>
                        <span class="value" id="taskState">-</span>
                    </div>
                    <div class="status-row">
                        <span class="label">х╜УхЙНцнещкд:</span>
                        <span class="value" id="taskStep">-</span>
                    </div>
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill" style="width: 0%;">0%</div>
                    </div>
                    <div class="status-row" style="margin-top: 12px;">
                        <span class="label">ц╢ИцБп:</span>
                        <span class="value" id="taskMessage">-</span>
                    </div>
                </div>

                <!-- цЧех┐Ч -->
                <div id="logContainer" class="log-container">
                    <div class="log-header">ЁЯУЛ шонч╗ГцЧех┐Ч</div>
                    <div id="logContent"></div>
                </div>
            </div>

            <!-- хП│ф╛зшбихНХ -->
            <div class="form-section">
                <form id="trainForm">
                    <div class="form-group">
                        <label>цибхЮЛщАЙцЛй</label>
                        <select name="model_choice" id="model_choice" onchange="toggleModelOptions()">
                            <option value="SyncTalk">SyncTalk</option>
                            <option value="GeneFace++" selected>GeneFace++</option>
                        </select>
                    </div>

                    <div id="synctalk_options" style="display: none;">
                        <div class="form-group">
                            <label>хПВшАГшзЖщвСхЬ░хЭА</label>
                            <input type="text" name="ref_video" placeholder="шп╖ш╛УхЕешзЖщвСш╖пх╛Д">
                        </div>
                        <div class="form-group">
                            <label>Epoch</label>
                            <input type="number" name="epoch" min="1" value="10">
                        </div>
                    </div>

                    <div id="geneface_options" >
                        <div class="form-group">
                            <label>шзЖщвСцЭец║Р</label>
                            <select id="video_source" onchange="toggleVideoSource()">
                                <option value="existing">щАЙцЛйх╖▓цЬЙшзЖщвС</option>
                                <option value="upload">ф╕Кф╝ацЦ░шзЖщвС</option>
                            </select>
                        </div>

                        <div class="form-group" id="existing_video_group">
                            <label>щАЙцЛйшзЖщвС</label>
                            <select name="video_id" id="video_select" onchange="onVideoSelected()">
                                <option value="">-- шп╖щАЙцЛй --</option>
                            </select>
                            <button type="button" onclick="refreshVideoList()" class="refresh-btn">тЯ│ хИ╖цЦ░хИЧшби</button>
                        </div>

                        <div class="form-group" id="upload_video_group" style="display: none;">
                            <label>ф╕Кф╝ашзЖщвС</label>
                            <input type="file" id="video_file" accept="video/mp4">
                            <input type="text" id="new_video_id" placeholder="Video ID" style="margin-top: 5px;">
                            <button type="button" onclick="uploadVideo()" style="margin-top: 5px;">ф╕Кф╝а</button>
                            <span id="upload_status"></span>
                        </div>

                        <div class="form-group">
                            <label>шонч╗ГщШ╢цо╡</label>
                            <select name="train_stage" id="train_stage" onchange="onTrainStageChange()">
                                <option value="preprocess">1. цХ░цНощвДхдДчРЖ</option>
                                <option value="head">2. хд┤щГицибхЮЛшонч╗Г</option>
                                <option value="torso">3. ш║лф╜УцибхЮЛшонч╗Г</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>шонч╗ГцнецХ░ (Total Steps)</label>
                            <input type="number" name="max_updates_head" placeholder="хд┤щГишонч╗ГцА╗цнецХ░ (щ╗Шшод 250000)" value="250000">
                            <input type="number" name="max_updates_torso" placeholder="ш║лф╜Ушонч╗ГцА╗цнецХ░ (щ╗Шшод 250000)" value="250000" style="margin-top: 5px;">
                            <small style="color: #888; display: block; margin-top: 5px;">ц│ицДПя╝Ъш┐ЩцШпч┤пшобцА╗цнецХ░уАВхжВцЮЬцЦнчВ╣ч╗ншоня╝Мшп╖шо╛ч╜оцпФх╜УхЙНцнецХ░цЫ┤хдзчЪДхА╝уАВ</small>
                        </div>

                        <div class="form-group" id="head_ckpt_group" style="display: none;">
                            <label>Head Checkpoint (чФиф║Ош║лф╜Ушонч╗Г)</label>
                            <select name="head_ckpt" id="head_ckpt_select">
                                <option value="">-- шп╖хЕИщАЙцЛйшзЖщвС --</option>
                            </select>
                            <div style="font-size: 12px; color: #888; margin-top: 4px;">
                                * х░ЖшЗкхКихКаш╜╜хп╣х║ФшзЖщвС ID ф╕ЛчЪДхд┤щГицибхЮЛ
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>GPUщАЙцЛй</label>
                        <select name="gpu_choice">
                            <option value="GPU0">GPU 0</option>
                            <option value="GPU1">GPU 1</option>
                        </select>
                    </div>
					
					<div class="btn-group">
						<button type="submit" class="generate-btn" id="submitBtn">х╝АхзЛшонч╗Г</button>
						<button type="button" class="generate-btn stop-btn" id="stopBtn" style="display: none; background: #e57373;">хБЬцнвшонч╗Г</button>
					</div>
					
                    <!--<button type="submit" class="generate-btn" id="submitBtn">х╝АхзЛшонч╗Г</button>-->
                </form>

                <div id="geneface_status" style="margin-top: 10px; ">
                    <span id="service_status"></span>
                </div>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/model_training.js') }}"></script>
    <script src="{{ url_for('static', filename='js/instruction.js') }}"></script>
</body>
</html>